<svg host="65bd71144e" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="4417px" height="2806px" viewBox="-0.5 -0.5 4417 2806" content="&lt;mxfile&gt;&lt;diagram id=&quot;3KwbdyD06HSjcGMrvIiw&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;">
    <defs/>
    <g>
        <path d="M 3026 596 L 3276 596 L 3276 783 Q 3213.5 723.6 3151 783 Q 3088.5 842.4 3026 783 L 3026 629 Z" fill="#ffff99" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 248px; height: 1px; padding-top: 673px; margin-left: 3027px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <b>
                                        dim = 4096
                                        <br/>
                                        n_layers  =32
                                        <br/>
                                        n_heads = 32
                                        <br/>
                                        n_heads_kv = Optional
                                        <br/>
                                        <br/>
                                        multiple_of = 256
                                        <br/>
                                        ffn_dim_multiplier = Optional
                                        <br/>
                                        <br/>
                                        max_batch_size = 32
                                        <br/>
                                        max_seq_len = 2048
                                    </b>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3151" y="676" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    dim = 4096...
                </text>
            </switch>
        </g>
        <rect x="2895" y="666" width="170" height="40" fill="#333333" stroke="#f0f0f0" pointer-events="all"/>
        <path d="M 2912 666 L 2912 706 M 3048 666 L 3048 706" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 134px; height: 1px; padding-top: 686px; margin-left: 2914px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <span style="color: rgb(156, 220, 254);">
                                    (hidden dim of FF layer)
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2981" y="690" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    (hidden dim of FF laye...
                </text>
            </switch>
        </g>
        <rect x="2895" y="716" width="170" height="40" fill="#333333" stroke="#f0f0f0" pointer-events="all"/>
        <path d="M 2912 716 L 2912 756 M 3048 716 L 3048 756" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 134px; height: 1px; padding-top: 736px; margin-left: 2914px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <span style="color: rgb(156, 220, 254);">
                                    For KV cache
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2981" y="740" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    For KV cache
                </text>
            </switch>
        </g>
        <path d="M 2905 896 L 3045 896 L 3065 946 L 3045 996 L 2905 996 L 2885 946 Z" fill="#ffff66" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 946px; margin-left: 2886px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font style="font-size: 18px;">
                                        TRANSFORMER
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2975" y="950" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    TRANSFORMER
                </text>
            </switch>
        </g>
        <path d="M 3015 466 L 3155 466 L 3175 516 L 3155 566 L 3015 566 L 2995 516 Z" fill="#ffff66" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 516px; margin-left: 2996px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font style="font-size: 18px;">
                                        Model Args
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3085" y="520" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Model Args
                </text>
            </switch>
        </g>
        <path d="M 2715 1186 L 2818.63 1186" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2823.88 1186 L 2816.88 1189.5 L 2818.63 1186 L 2816.88 1182.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="2465" y="1156" width="250" height="60" fill="#ffcce6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 248px; height: 1px; padding-top: 1186px; margin-left: 2466px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                tok_embds
                                <br/>
                                <i>
                                    nn.Embd(vocab_size, dim)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2590" y="1191" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    tok_embds...
                </text>
            </switch>
        </g>
        <path d="M 2745 1386 L 2793.63 1386" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2798.88 1386 L 2791.88 1389.5 L 2793.63 1386 L 2791.88 1382.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 2485 1356 L 2099.28 1781.28" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2095.75 1785.17 L 2097.86 1777.64 L 2099.28 1781.28 L 2103.05 1782.34 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1619px; margin-left: 2208px;">
                        <div data-drawio-colors="color: #E6E6E6; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 24px; font-family: Helvetica; color: rgb(230, 230, 230); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
                                <font color="#1a1a1a" style="">
                                    <font style="background-color: rgb(240, 240, 240); font-size: 14px;">
                                        forward method
                                        <i style="">
                                            <b style="">
                                                (x, start_pos, freqs_complex)
                                            </b>
                                        </i>
                                    </font>
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2208" y="1626" fill="#E6E6E6" font-family="Helvetica" font-size="24px" text-anchor="middle">
                    forward method (x, start_pos, freqs_complex)
                </text>
            </switch>
        </g>
        <rect x="2485" y="1356" width="260" height="60" fill="#ffcce6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 258px; height: 1px; padding-top: 1386px; margin-left: 2486px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                layers (n_layers times)
                                <br/>
                                <i>
                                    <b>
                                        EncoderBlock
                                    </b>
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2615" y="1391" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    layers (n_layers times)...
                </text>
            </switch>
        </g>
        <path d="M 2710 1481 L 2871.13 1481" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2876.38 1481 L 2869.38 1484.5 L 2871.13 1481 L 2869.38 1477.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 2520 1483 L 2487 1483 L 2487 1949 Q 2487 1953 2483 1953 L 2125 1953 M 2125 1949 L 2483 1949 L 2483 1483 Q 2483 1479 2487 1479 L 2520 1479 M 2125 1949" fill="none" stroke="#f0f0f0" stroke-linejoin="round" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 2520 1483 L 2487 1483 L 2487 2136 L 2487 2220 M 2483 2220 L 2483 2136 Q 2483 2136 2483 2136 L 2483 1483 Q 2483 1479 2487 1479 L 2520 1479 M 2483 2220" fill="none" stroke="#f0f0f0" stroke-linejoin="round" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="2520" y="1451" width="190" height="60" fill="#ffcce6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 188px; height: 1px; padding-top: 1481px; margin-left: 2521px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <span style="background-color: rgb(255, 255, 153);">
                                    <b>
                                        RMSNorm
                                    </b>
                                    <br/>
                                </span>
                                <i>
                                    (vocab_size, dim)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2615" y="1486" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    RMSNorm...
                </text>
            </switch>
        </g>
        <path d="M 2710 1586 L 2798.63 1586" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2803.88 1586 L 2796.88 1589.5 L 2798.63 1586 L 2796.88 1582.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="2520" y="1556" width="190" height="60" fill="#ffcce6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 188px; height: 1px; padding-top: 1586px; margin-left: 2521px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                output  - linear
                                <br/>
                                <i>
                                    (dim, vocab_size)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2615" y="1591" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    output  - linear...
                </text>
            </switch>
        </g>
        <path d="M 2755 1286 L 2818.63 1286" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2823.88 1286 L 2816.88 1289.5 L 2818.63 1286 L 2816.88 1282.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 2385 1248.5 L 2237.22 851.97" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2235.39 847.05 L 2241.11 852.38 L 2237.22 851.97 L 2234.56 854.83 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="2385" y="1248.5" width="370" height="75" fill="#ffcce6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 368px; height: 1px; padding-top: 1286px; margin-left: 2386px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                freqs_complex
                                <br/>
                                <b>
                                    precompute_theta_pos_frequencies
                                </b>
                                <br/>
                                <i>
                                    (seq_len, head_dim/2)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2570" y="1291" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    freqs_complex...
                </text>
            </switch>
        </g>
        <path d="M 2975 1216 L 2975 1249.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2975 1254.88 L 2971.5 1247.88 L 2975 1249.63 L 2978.5 1247.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="2825" y="1156" width="300" height="60" fill="#99ffff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 298px; height: 1px; padding-top: 1186px; margin-left: 2826px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                h = tok_embeddings(tokens)
                                <br/>
                                <i>
                                    (B, 1) -&gt; (B, 1, dim)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2975" y="1191" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    h = tok_embeddings(tokens)...
                </text>
            </switch>
        </g>
        <path d="M 3296 226 L 3386 226 L 3406 256 L 3386 286 L 3296 286 L 3276 256 Z" fill="#ffff66" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 256px; margin-left: 3277px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font style="font-size: 18px;">
                                        Big module
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3341" y="260" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Big module
                </text>
            </switch>
        </g>
        <rect x="3426" y="231" width="130" height="50" fill="#ffcce6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 256px; margin-left: 3427px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                Init
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3491" y="261" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    Init
                </text>
            </switch>
        </g>
        <rect x="3586" y="241" width="110" height="30" fill="#99ffff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 256px; margin-left: 3587px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                forward
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3641" y="261" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    forward
                </text>
            </switch>
        </g>
        <path d="M 3965 706 L 3871.37 706" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3866.12 706 L 3873.12 702.5 L 3871.37 706 L 3873.12 709.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 3760 736 L 3760 769.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3760 774.88 L 3756.5 767.88 L 3760 769.63 L 3763.5 767.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 3655 706 L 3070.9 943.6" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3066.04 945.58 L 3071.2 939.7 L 3070.9 943.6 L 3073.84 946.18 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 837px; margin-left: 3329px;">
                        <div data-drawio-colors="color: #1A1A1A; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
                                <span style="background-color: rgb(230, 230, 230);">
                                    <font style="font-size: 24px;">
                                        model_args
                                    </font>
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3329" y="841" fill="#1A1A1A" font-family="Helvetica" font-size="14px" text-anchor="middle">
                    model_args
                </text>
            </switch>
        </g>
        <rect x="3655" y="676" width="210" height="60" fill="#647687" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 208px; height: 1px; padding-top: 706px; margin-left: 3656px;">
                        <div data-drawio-colors="color: #ffffff; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    LLaMA.build()
                                    <br/>
                                    <b>
                                        <i>
                                            Model = Transformer(model_args)
                                        </i>
                                    </b>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3760" y="710" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    LLaMA.build()...
                </text>
            </switch>
        </g>
        <rect x="3965" y="676" width="220" height="60" fill="#fad7ac" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 706px; margin-left: 3966px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    Load weights using
                                    <i>
                                        <br/>
                                        <b>
                                            model.load_state_dict(checkpoint)
                                        </b>
                                    </i>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="4075" y="710" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Load weights using...
                </text>
            </switch>
        </g>
        <path d="M 3760 836 L 3760 869.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3760 874.88 L 3756.5 867.88 L 3760 869.63 L 3763.5 867.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3655" y="776" width="210" height="60" fill="#647687" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 208px; height: 1px; padding-top: 806px; margin-left: 3656px;">
                        <div data-drawio-colors="color: #ffffff; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <b>
                                        <i>
                                            Model.text_completion(prompts)
                                        </i>
                                    </b>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3760" y="810" fill="#ffffff" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Model.text_completion(prompts)
                </text>
            </switch>
        </g>
        <path d="M 3760 936 L 3760 969.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3760 974.88 L 3756.5 967.88 L 3760 969.63 L 3763.5 967.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3655" y="876" width="210" height="60" fill="#d5e8d4" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 208px; height: 1px; padding-top: 906px; margin-left: 3656px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <i style="">
                                        prompts --&gt; prompt tokens
                                        <br/>
                                        <b>
                                            tokenizer_encode
                                        </b>
                                        <br/>
                                        add bos, not add eos
                                        <br/>
                                    </i>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3760" y="910" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    prompts --&gt; prompt tokens...
                </text>
            </switch>
        </g>
        <path d="M 3795 526 L 3935 526 L 3955 576 L 3935 626 L 3795 626 L 3775 576 Z" fill="#ffff66" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 576px; margin-left: 3776px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font style="font-size: 18px;">
                                    <b>
                                        LLaMA
                                    </b>
                                    <br/>
                                    class for inference
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3865" y="580" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    LLaMA...
                </text>
            </switch>
        </g>
        <path d="M 3955 906 L 3871.37 906" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3866.12 906 L 3873.12 902.5 L 3871.37 906 L 3873.12 909.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3955" y="876" width="220" height="60" fill="#fad7ac" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 906px; margin-left: 3956px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    checks on
                                    <br/>
                                    batch_size, max_prompt_len
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="4065" y="910" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    checks on...
                </text>
            </switch>
        </g>
        <path d="M 3760 1036 L 3760 1059.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3760 1064.88 L 3756.5 1057.88 L 3760 1059.63 L 3763.5 1057.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3655" y="976" width="210" height="60" fill="#d5e8d4" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 208px; height: 1px; padding-top: 1006px; margin-left: 3656px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <i style="">
                                        tokens = (batch_size, total_len)
                                        <br/>
                                        Pad tokens at leftover places
                                        <br/>
                                    </i>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3760" y="1010" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    tokens = (batch_size, total_len)...
                </text>
            </switch>
        </g>
        <path d="M 3955 1006 L 3871.37 1006" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3866.12 1006 L 3873.12 1002.5 L 3871.37 1006 L 3873.12 1009.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3955" y="976" width="220" height="60" fill="#fad7ac" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 1006px; margin-left: 3956px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    No unncessary compute
                                    <br/>
                                    <b>
                                        total_len = min(max_seq_len,
                                        <br/>
                                        max_gen_len + max_prompt_len)
                                    </b>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="4065" y="1010" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    No unncessary compute...
                </text>
            </switch>
        </g>
        <path d="M 3760 1146 L 3760 1189.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3760 1194.88 L 3756.5 1187.88 L 3760 1189.63 L 3763.5 1187.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 3635 1106 L 3126.33 1046.74" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3121.11 1046.13 L 3128.47 1043.46 L 3126.33 1046.74 L 3127.66 1050.42 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3635" y="1066" width="250" height="80" fill="#d5e8d4" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 248px; height: 1px; padding-top: 1106px; margin-left: 3636px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i style="">
                                    <font color="#0000cc">
                                        logits
                                    </font>
                                    <font color="#1a1a1a">
                                        =
                                        <b>
                                            model.forward
                                        </b>
                                        (
                                    </font>
                                    <br/>
                                    <font color="#1a1a1a">
                                        tokens = tokens[:, cur_pos-1:cur_pos], start_idx = cur_pos)
                                    </font>
                                    <br/>
                                    <br/>
                                </i>
                                <b>
                                    <font color="#0000cc">
                                        logits shape: (batch_size, 1, vocab_size)
                                    </font>
                                </b>
                                <font color="#1a1a1a">
                                    <i style="">
                                        <br/>
                                    </i>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3760" y="1110" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    logits = model.forward(...
                </text>
            </switch>
        </g>
        <path d="M 3955 1106 L 3891.37 1106" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3886.12 1106 L 3893.12 1102.5 L 3891.37 1106 L 3893.12 1109.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3955" y="1076" width="220" height="60" fill="#fad7ac" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 1106px; margin-left: 3956px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    Generate 1 token at a time
                                    <br/>
                                    <b>
                                        for cur_pos in range(1, total_len):
                                    </b>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="4065" y="1110" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Generate 1 token at a time...
                </text>
            </switch>
        </g>
        <path d="M 3760 1256 L 3760 1319.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3760 1324.88 L 3756.5 1317.88 L 3760 1319.63 L 3763.5 1317.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 3885 1196 L 3917 1172 Q 3925 1166 3934.98 1165.41 L 4255.02 1146.59 Q 4265 1146 4268.16 1136.51 L 4282.99 1092.04" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 4284.65 1087.06 L 4285.75 1094.81 L 4282.99 1092.04 L 4279.11 1092.59 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3635" y="1196" width="250" height="60" fill="#d5e8d4" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 248px; height: 1px; padding-top: 1226px; margin-left: 3636px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i style="">
                                    <font color="#1a1a1a">
                                        probs = softmax(logits[:, -1] / temperature)
                                    </font>
                                    <br/>
                                    <b style="">
                                        <font color="#1a1a1a">
                                            next_token =
                                        </font>
                                        <font color="#006633">
                                            _sample_top_p
                                        </font>
                                        <font color="#1a1a1a">
                                            (probs)
                                        </font>
                                        <br/>
                                    </b>
                                </i>
                                <b>
                                    <font color="#0000cc">
                                        <br/>
                                        shape: (batch_size, )
                                    </font>
                                </b>
                                <font color="#1a1a1a">
                                    <i style="">
                                        <br/>
                                    </i>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3760" y="1230" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    probs = softmax(logits[:, -1] / temperatu...
                </text>
            </switch>
        </g>
        <path d="M 3955 1226 L 3891.37 1226" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3886.12 1226 L 3893.12 1222.5 L 3891.37 1226 L 3893.12 1229.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3955" y="1176" width="220" height="100" fill="#fad7ac" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 1226px; margin-left: 3956px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <b>
                                        logits[:, -1] --&gt; along vocab dim
                                        <br/>
                                        (for all in batch)
                                    </b>
                                    <br/>
                                    We take argmax directly (greedy) if temperature not given
                                    <br/>
                                    <i>
                                        next_token = argmax(...)
                                    </i>
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="4065" y="1230" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    logits[:, -1] --&gt; along vocab dim...
                </text>
            </switch>
        </g>
        <path d="M 4185 1176 L 4205 1196 L 4185 1216 L 4165 1196 Z" fill="#cc0000" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3635" y="1326" width="250" height="60" fill="#d5e8d4" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 248px; height: 1px; padding-top: 1356px; margin-left: 3636px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a" style="font-weight: bold;">
                                    <i>
                                        tokens[:, cur_pos] = next_token
                                    </i>
                                </font>
                                <br/>
                                <font color="#1a1a1a" style="">
                                    shape: (batch_size, total_len)
                                </font>
                                <font color="#1a1a1a">
                                    <i style="">
                                        <br/>
                                    </i>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3760" y="1360" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    tokens[:, cur_pos] = next_token...
                </text>
            </switch>
        </g>
        <path d="M 3955 1356 L 3891.37 1356" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3886.12 1356 L 3893.12 1352.5 L 3891.37 1356 L 3893.12 1359.5 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="3955" y="1316" width="220" height="80" fill="#fad7ac" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 1356px; margin-left: 3956px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <b>
                                        next_token =
                                        <br/>
                                        actual token if mask == 1
                                        <br/>
                                    </b>
                                    predicted token if mask == 0
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="4065" y="1360" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    next_token =...
                </text>
            </switch>
        </g>
        <rect x="3635" y="1436" width="250" height="70" fill="#d5e8d4" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 248px; height: 1px; padding-top: 1471px; margin-left: 3636px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i style="color: rgb(26, 26, 26);">
                                    <b>
                                        out_tokens = [B lists]
                                        <br/>
                                        out_text = [B lists]
                                    </b>
                                </i>
                                <font color="#1a1a1a">
                                    <i style="">
                                        <br/>
                                    </i>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3760" y="1475" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    out_tokens = [B lists]...
                </text>
            </switch>
        </g>
        <rect x="3955" y="1426" width="270" height="80" fill="#fad7ac" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 268px; height: 1px; padding-top: 1466px; margin-left: 3956px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <i>
                                        EOS_reached for any sentence iff we generated EOS token for a padding position
                                        <br/>
                                    </i>
                                    <br/>
                                </font>
                                <i style="color: rgb(26, 26, 26);">
                                    break token-wise generation if  eos_reached for all in batch
                                    <br/>
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="4090" y="1470" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    EOS_reached for any sentence iff we generated...
                </text>
            </switch>
        </g>
        <rect x="4285" y="1056" width="130" height="30" fill="#66ff66" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 1071px; margin-left: 4286px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i style="">
                                    <b style="">
                                        <font color="#1a1a1a">
                                            _sample_top_p
                                        </font>
                                    </b>
                                </i>
                                <font color="#1a1a1a">
                                    <i style="">
                                        <br/>
                                    </i>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="4350" y="1075" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    _sample_top_p
                </text>
            </switch>
        </g>
        <path d="M 2975 1126 L 2975 1149.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2975 1154.88 L 2971.5 1147.88 L 2975 1149.63 L 2978.5 1147.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="2830" y="1046" width="290" height="80" fill="#66ffff" stroke="#f0f0f0" pointer-events="all"/>
        <path d="M 2859 1046 L 2859 1126 M 3091 1046 L 3091 1126" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 231px; height: 1px; padding-top: 1086px; margin-left: 2860px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <i style="">
                                        <font style="font-size: 14px;">
                                            Forward method
                                            <br/>
                                            <b>
                                                tokens: tensor = (B, seq_len = 1), start_idx: int
                                            </b>
                                        </font>
                                        <br/>
                                    </i>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2975" y="1090" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Forward method...
                </text>
            </switch>
        </g>
        <path d="M 2495 1126 L 2515 1066 L 2705 1066 L 2685 1126 Z" fill="#e6e6e6" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 208px; height: 1px; padding-top: 1096px; margin-left: 2496px;">
                        <div data-drawio-colors="color: #1A1A1A; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                Note how all of them can be
                                <b>
                                    computed by model_args only
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2600" y="1100" fill="#1A1A1A" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Note how all of them can be compute...
                </text>
            </switch>
        </g>
        <path d="M 2975 1316 L 2975 1349.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2975 1354.88 L 2971.5 1347.88 L 2975 1349.63 L 2978.5 1347.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="2825" y="1256" width="300" height="60" fill="#99ffff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 298px; height: 1px; padding-top: 1286px; margin-left: 2826px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i>
                                    get freqs_complex for this position
                                    <br/>
                                </i>
                                [start_idx: start_idx + 1]
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2975" y="1291" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    get freqs_complex for this positi...
                </text>
            </switch>
        </g>
        <path d="M 2975 1416 L 2975 1449.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2975 1454.88 L 2971.5 1447.88 L 2975 1449.63 L 2978.5 1447.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="2800" y="1356" width="350" height="60" fill="#99ffff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 348px; height: 1px; padding-top: 1386px; margin-left: 2801px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i>
                                    h = layer(h, start_idx, freqs_complex)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2975" y="1391" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    h = layer(h, start_idx, freqs_complex)
                </text>
            </switch>
        </g>
        <path d="M 2975 1506 L 2975 1539.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2975 1544.88 L 2971.5 1537.88 L 2975 1539.63 L 2978.5 1537.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="2877.5" y="1456" width="195" height="50" fill="#99ffff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 193px; height: 1px; padding-top: 1481px; margin-left: 2879px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i>
                                    h = norm(h)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2975" y="1486" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    h = norm(h)
                </text>
            </switch>
        </g>
        <path d="M 3145 1546 L 3630.07 1150.03" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 3634.13 1146.71 L 3630.92 1153.84 L 3630.07 1150.03 L 3626.5 1148.42 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="2805" y="1546" width="340" height="80" fill="#99ffff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 338px; height: 1px; padding-top: 1586px; margin-left: 2806px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i>
                                    h = output_layer(h)
                                    <br/>
                                    <b>
                                        (B, 1, dim) -&gt; (B, 1, vocab_size)
                                    </b>
                                    <br/>
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2975" y="1591" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    h = output_layer(h)...
                </text>
            </switch>
        </g>
        <rect x="1865" y="846" width="370" height="75" fill="#ffe6cc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 368px; height: 1px; padding-top: 884px; margin-left: 1866px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    precompute_theta_pos_frequencies
                                </b>
                                <br/>
                                <i>
                                    (head_dim = dim // n_heads,
                                    <br/>
                                    <b>
                                        seq_len = max_seq_len *2 )
                                    </b>
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2050" y="889" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    precompute_theta_pos_frequencies...
                </text>
            </switch>
        </g>
        <rect x="1865" y="941" width="370" height="75" fill="#ffe6cc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 368px; height: 1px; padding-top: 979px; margin-left: 1866px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    theta_i
                                </b>
                                = 10000 ^ (-2 *(i-1) / dim)
                                <br/>
                                <i>
                                    i = [1, 2, ... , dim/2]
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2050" y="984" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    theta_i = 10000 ^ (-2 *(i-1) / dim)...
                </text>
            </switch>
        </g>
        <rect x="1865" y="1036" width="370" height="75" fill="#ffe6cc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 368px; height: 1px; padding-top: 1074px; margin-left: 1866px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    theta
                                </b>
                                = theta_1, theta_2, ..., theta_(dim/2)
                                <br/>
                                <i style="">
                                    <b>
                                        shape: (head_dim / 2)
                                    </b>
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2050" y="1079" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    theta = theta_1, theta_2, ..., theta_(dim...
                </text>
            </switch>
        </g>
        <path d="M 3178.75 1118.5 L 3222.5 1162.25 L 3178.75 1206 L 3135 1162.25 Z" fill="#cc0000" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 85px; height: 1px; padding-top: 1162px; margin-left: 3136px;">
                        <div data-drawio-colors="color: #1A1A1A; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font color="#e6e6e6">
                                        seq_len = 1
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="3179" y="1166" fill="#1A1A1A" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    seq_len = 1
                </text>
            </switch>
        </g>
        <rect x="1865" y="1131" width="370" height="75" fill="#ffe6cc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 368px; height: 1px; padding-top: 1169px; margin-left: 1866px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    m
                                </b>
                                = arange(seq_len)
                                <br/>
                                <i style="font-weight: bold;">
                                    shape: (seq_len)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2050" y="1174" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    m = arange(seq_len)...
                </text>
            </switch>
        </g>
        <rect x="1835" y="1226" width="430" height="75" fill="#ffe6cc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 428px; height: 1px; padding-top: 1264px; margin-left: 1836px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    freqs
                                </b>
                                = torch.outer(m, theta)
                                <br/>
                                <i style="font-weight: bold;">
                                    seq_len (*) head_dim/2 -&gt; (seq_len, head_dim/2)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2050" y="1269" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    freqs = torch.outer(m, theta)...
                </text>
            </switch>
        </g>
        <path d="M 2265 1396 L 2379.55 1326.79" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2384.04 1324.08 L 2379.86 1330.69 L 2379.55 1326.79 L 2376.24 1324.7 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="1835" y="1321" width="430" height="75" fill="#ffe6cc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 428px; height: 1px; padding-top: 1359px; margin-left: 1836px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    freqs_complex
                                </b>
                                = torch.polar(
                                <br/>
                                abs = ones_like(freqs), angle = freqs)
                                <br/>
                                <i style="font-weight: bold;">
                                    (seq_len, head_dim/2)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2050" y="1364" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    freqs_complex = torch.polar(...
                </text>
            </switch>
        </g>
        <rect x="1875" y="1416" width="350" height="50" fill="#ffe6cc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 348px; height: 1px; padding-top: 1441px; margin-left: 1876px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i>
                                    have **precomputed** freqs_complex
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2050" y="1446" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    have **precomputed** freqs_complex
                </text>
            </switch>
        </g>
        <path d="M 1925 1866 L 1925 1909.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1925 1914.88 L 1921.5 1907.88 L 1925 1909.63 L 1928.5 1907.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="1755" y="1786" width="340" height="80" fill="#cc99ff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 338px; height: 1px; padding-top: 1826px; margin-left: 1756px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i>
                                    x: (B, 1, dim)
                                    <br/>
                                    start_pos = int
                                    <br/>
                                    freqs_complex: (seq_len, head_dim/2)
                                </i>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1925" y="1831" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    x: (B, 1, dim)...
                </text>
            </switch>
        </g>
        <path d="M 1925 1986 L 1925 2064.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1925 2069.88 L 1921.5 2062.88 L 1925 2064.63 L 1928.5 2062.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 1725 1916 L 1311.45 143.45" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1310.25 138.34 L 1315.25 144.36 L 1311.45 143.45 L 1308.44 145.95 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 442px; margin-left: 1461px;">
                        <div data-drawio-colors="color: #1A1A1A; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
                                <span style="background-color: rgb(240, 240, 240);">
                                    forward method
                                    <i>
                                        <b>
                                            (x, start_pos, freqs_complex)
                                            <br/>
                                            init with ModelArgs
                                            <br/>
                                        </b>
                                    </i>
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1461" y="446" fill="#1A1A1A" font-family="Helvetica" font-size="14px" text-anchor="middle">
                    forward method (x, start_pos, freqs_complex)...
                </text>
            </switch>
        </g>
        <rect x="1725" y="1916" width="400" height="70" fill="#cc99ff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 398px; height: 1px; padding-top: 1951px; margin-left: 1726px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                h = x + attn.forward(
                                <br/>
                                <span style="background-color: rgb(255, 255, 153);">
                                    attention_norm(x)
                                </span>
                                , start_pos, freqs_complex)
                                <br/>
                                <b>
                                    <i>
                                        (B, 1, dim)
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1925" y="1956" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    h = x + attn.forward(...
                </text>
            </switch>
        </g>
        <path d="M 2125 2104 L 2483 2104 L 2483 1483 Q 2483 1479 2487 1479 L 2520 1479 M 2520 1483 L 2487 1483 L 2487 2104 Q 2487 2108 2483 2108 L 2125 2108 M 2520 1483" fill="none" stroke="#f0f0f0" stroke-linejoin="round" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1853px; margin-left: 2476px;">
                        <div data-drawio-colors="color: #1A1A1A; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 24px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
                                <span style="background-color: rgb(255, 255, 153);">
                                    highlighted are RMSNorms
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2476" y="1860" fill="#1A1A1A" font-family="Helvetica" font-size="24px" text-anchor="middle">
                    highlighted are RMSNorms
                </text>
            </switch>
        </g>
        <path d="M 2125 2141 L 2482.17 1421.7" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 2484.5 1417 L 2484.52 1424.83 L 2482.17 1421.7 L 2478.25 1421.71 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 1725 2071 L 1656.7 2317.36" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1655.3 2322.42 L 1653.8 2314.74 L 1656.7 2317.36 L 1660.54 2316.61 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="1725" y="2071" width="400" height="70" fill="#cc99ff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 398px; height: 1px; padding-top: 2106px; margin-left: 1726px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                out = h + feed_forward(
                                <span style="background-color: rgb(255, 255, 153);">
                                    ffn_norm
                                </span>
                                (h))
                                <br/>
                                <b>
                                    <i>
                                        (B, 1, dim)
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1925" y="2111" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    out = h + feed_forward(ffn_norm(h))...
                </text>
            </switch>
        </g>
        <path d="M 1775 1666 L 1915 1666 L 1935 1716 L 1915 1766 L 1775 1766 L 1755 1716 Z" fill="#ffff66" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 1716px; margin-left: 1756px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font style="font-size: 18px;">
                                        EncoderBlock
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1845" y="1720" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    EncoderBlock
                </text>
            </switch>
        </g>
        <path d="M 2415 2220 L 2555 2220 L 2575 2270 L 2555 2320 L 2415 2320 L 2395 2270 Z" fill="#ffff66" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 2270px; margin-left: 2396px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font style="font-size: 18px;">
                                        RMSNorm
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2485" y="2274" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    RMSNorm
                </text>
            </switch>
        </g>
        <rect x="2280" y="2340" width="410" height="110" fill="#ffff99" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 408px; height: 1px; padding-top: 2395px; margin-left: 2281px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <span style="background-color: rgb(255, 255, 153);">
                                    _norm = x * torch.rsqrt (
                                    <br/>
                                    x.pow(2).mean(-1, keepdim=True) + eps)
                                    <br/>
                                    <b>
                                        <i>
                                            (B, 1, dim) * (B, 1, 1) -&gt; (B, 1, dim) (broadcasting!)
                                        </i>
                                    </b>
                                    <br/>
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2485" y="2400" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    _norm = x * torch.rsqrt (...
                </text>
            </switch>
        </g>
        <path d="M 2745 2340 L 2765 2300 L 2955 2300 L 2935 2340 Z" fill="#e6e6e6" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 208px; height: 1px; padding-top: 2320px; margin-left: 2746px;">
                        <div data-drawio-colors="color: #1A1A1A; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                rsqrt --&gt; reciprocal sqrt
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2850" y="2324" fill="#1A1A1A" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    rsqrt --&gt; reciprocal sqrt
                </text>
            </switch>
        </g>
        <path d="M 2725 2440 L 2745 2370 L 3065 2370 L 3045 2440 Z" fill="#e6e6e6" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 338px; height: 1px; padding-top: 2405px; margin-left: 2726px;">
                        <div data-drawio-colors="color: #1A1A1A; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <div>
                                    x.pow(2): (B, seq_len, dim)
                                </div>
                                <div>
                                    <span style="background-color: initial;">
                                        x.pow(2).mean(-1) : (B, seq_len)
                                    </span>
                                </div>
                                <div>
                                    <span style="background-color: initial;">
                                        x.pow(2).mean(-1, keepdim = True) : (B, seq_len, 1)
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2895" y="2409" fill="#1A1A1A" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    x.pow(2): (B, seq_len, dim)...
                </text>
            </switch>
        </g>
        <rect x="2280" y="2480" width="410" height="80" fill="#ffff99" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 408px; height: 1px; padding-top: 2520px; margin-left: 2281px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <span style="background-color: rgb(255, 255, 153);">
                                    return gamma * _norm(x.float())
                                    <br/>
                                    <b>
                                        <i>
                                            (dim) * (B, 1, dim) -&gt; (B, 1, dim)
                                        </i>
                                    </b>
                                    <br/>
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2485" y="2525" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    return gamma * _norm(x.float())...
                </text>
            </switch>
        </g>
        <path d="M 2725 2540 L 2745 2500 L 3015 2500 L 2995 2540 Z" fill="#e6e6e6" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 288px; height: 1px; padding-top: 2520px; margin-left: 2726px;">
                        <div data-drawio-colors="color: #1A1A1A; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                gamma = nn.Parameter(torch.ones(dim)
                                <br/>
                                <b>
                                    <i>
                                        learnable xD
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="2870" y="2524" fill="#1A1A1A" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    gamma = nn.Parameter(torch.ones(dim)...
                </text>
            </switch>
        </g>
        <path d="M 1080 227.25 L 1080 290.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 296.13 L 1076.5 289.13 L 1080 290.88 L 1083.5 289.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="850" y="137.25" width="460" height="90" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 182px; margin-left: 851px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    xq
                                </b>
                                = self.wq(x)
                                <br/>
                                <b>
                                    xk
                                </b>
                                = self.wk(x)
                                <br/>
                                <b>
                                    xv
                                </b>
                                = self.wv(x)
                                <br/>
                                <b>
                                    <i>
                                        (B, 1, dim) -&gt; (B, 1, n_heads_(q/kv) * head_dim)
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="188" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    xq = self.wq(x)...
                </text>
            </switch>
        </g>
        <path d="M 770 182.25 L 843.63 182.25" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 848.88 182.25 L 841.88 185.75 L 843.63 182.25 L 841.88 178.75 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="470" y="156" width="300" height="52.5" fill="#fad7ac" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 298px; height: 1px; padding-top: 182px; margin-left: 471px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    self.wq = nn.Linear(dim,
                                    <b>
                                        n_heads_q *
                                    </b>
                                </font>
                                <span style="color: rgb(26, 26, 26);">
                                    <b>
                                        head_dim
                                    </b>
                                </span>
                                <font color="#1a1a1a">
                                    )
                                    <br/>
                                </font>
                                <font color="#1a1a1a">
                                    self.wk = nn.Linear(dim,
                                    <b>
                                        n_heads_kv *
                                    </b>
                                </font>
                                <span style="color: rgb(26, 26, 26);">
                                    <b>
                                        head_dim
                                    </b>
                                </span>
                                <font color="#1a1a1a">
                                    )
                                </font>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                                <font color="#1a1a1a">
                                    self.wv = nn.Linear(dim,
                                    <b>
                                        n_heads_kv *
                                    </b>
                                </font>
                                <span style="color: rgb(26, 26, 26);">
                                    <b>
                                        head_dim
                                    </b>
                                </span>
                                <font color="#1a1a1a">
                                    )
                                </font>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="620" y="186" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    self.wq = nn.Linear(dim, n_heads_q * head_dim)...
                </text>
            </switch>
        </g>
        <path d="M 1080 377.25 L 1080 430.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 436.13 L 1076.5 429.13 L 1080 430.88 L 1083.5 429.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="850" y="297.25" width="460" height="80" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 337px; margin-left: 851px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                xq = xq.
                                <b>
                                    view
                                </b>
                                (B, 1, n_heads_q, head_dim)
                                <br/>
                                Similarly xk, xv
                                <br/>
                                <b>
                                    <i>
                                        (B, 1, n_heads_(q/kv), head_dim)
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="343" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    xq = xq.view(B, 1, n_heads_q, head_dim)...
                </text>
            </switch>
        </g>
        <path d="M 1080 517.25 L 1080 583.38" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 588.63 L 1076.5 581.63 L 1080 583.38 L 1083.5 581.63 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="850" y="437.25" width="460" height="80" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 477px; margin-left: 851px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                xq =
                                <b>
                                    apply_rope
                                </b>
                                (xq, freqs_complex)
                                <br/>
                                xk = apply_rope(xk, freqs_complex)
                                <br/>
                                <b>
                                    <i>
                                        (B, 1, n_heads_(q/kv), head_dim)
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="483" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    xq = apply_rope(xq, freqs_complex)...
                </text>
            </switch>
        </g>
        <path d="M 770 477.25 L 843.63 477.25" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 848.88 477.25 L 841.88 480.75 L 843.63 477.25 L 841.88 473.75 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 470 451 L 362.81 232.96" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 360.49 228.25 L 366.72 232.99 L 362.81 232.96 L 360.44 236.08 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="470" y="451" width="300" height="52.5" fill="#fad7ac" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 298px; height: 1px; padding-top: 477px; margin-left: 471px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <b>
                                        Multiple transformations
                                    </b>
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="620" y="481" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Multiple transformations
                </text>
            </switch>
        </g>
        <path d="M 1330 507.25 L 1350 467.25 L 1500 467.25 L 1480 507.25 Z" fill="#e6e6e6" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 487px; margin-left: 1331px;">
                        <div data-drawio-colors="color: #1A1A1A; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                RoPE only to xq, xk
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1415" y="491" fill="#1A1A1A" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    RoPE only to xq, xk
                </text>
            </switch>
        </g>
        <path d="M 180 279.75 L 180 300.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 180 306.13 L 176.5 299.13 L 180 300.88 L 183.5 299.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="0" y="227.25" width="360" height="52.5" fill="#ccffe6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 358px; height: 1px; padding-top: 254px; margin-left: 1px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    x = x.reshape(*x.shape[:-1], -1,2)
                                    <br/>
                                    <b>
                                        (B, 1, n_heads, head_dim) -&gt;
                                    </b>
                                </font>
                                <span style="color: rgb(26, 26, 26);">
                                    <b>
                                        (B, 1, n_heads, head_dim/2, 2)
                                    </b>
                                </span>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="180" y="257" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    x = x.reshape(*x.shape[:-1], -1,2)...
                </text>
            </switch>
        </g>
        <path d="M 180 359.75 L 180 393.38" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 180 398.63 L 176.5 391.63 L 180 393.38 L 183.5 391.63 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="0" y="307.25" width="360" height="52.5" fill="#ccffe6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 358px; height: 1px; padding-top: 334px; margin-left: 1px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    x_complex = torch.view_as_complex(x)
                                    <br/>
                                    <b>
                                        (B, 1, n_heads, head_dim/2, 2) -&gt;
                                    </b>
                                </font>
                                <span style="color: rgb(26, 26, 26);">
                                    <b>
                                        (B, 1, n_heads, head_dim/2)
                                    </b>
                                </span>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="180" y="337" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    x_complex = torch.view_as_complex(x)...
                </text>
            </switch>
        </g>
        <path d="M 180 469.75 L 180 493.38" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 180 498.63 L 176.5 491.63 L 180 493.38 L 183.5 491.63 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="0" y="399.75" width="360" height="70" fill="#ccffe6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 358px; height: 1px; padding-top: 435px; margin-left: 1px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    freqs_complex =
                                </font>
                                <span style="color: rgb(26, 26, 26);">
                                    freqs_complex.unsqueeze(0).unsqueeze(2)
                                </span>
                                <font color="#1a1a1a">
                                    <br/>
                                    <b>
                                        (seq_len, head_dim/2) -&gt;
                                        <br/>
                                    </b>
                                </font>
                                <span style="color: rgb(26, 26, 26);">
                                    <b>
                                        (1, seq_len, head_dim/2) -&gt;
                                    </b>
                                </span>
                                <b style="color: rgb(26, 26, 26);">
                                    <br/>
                                </b>
                                <b style="color: rgb(26, 26, 26);">
                                    (1, seq_len, 1, head_dim/2)
                                </b>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="180" y="438" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    freqs_complex = freqs_complex.unsqueeze(0).unsqueeze(2)...
                </text>
            </switch>
        </g>
        <path d="M 180 569.75 L 180 593.38" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 180 598.63 L 176.5 591.63 L 180 593.38 L 183.5 591.63 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="0" y="499.75" width="360" height="70" fill="#ccffe6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 358px; height: 1px; padding-top: 535px; margin-left: 1px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    x_rotated = x_complex * freqs_complex
                                </font>
                                <font color="#1a1a1a">
                                    <br/>
                                    <b>
                                        (B, 1, n_heads, head_dim/2) *
                                    </b>
                                </font>
                                <b style="color: rgb(26, 26, 26);">
                                    (1, seq_len, 1, head_dim/2) -&gt;
                                </b>
                                <font color="#1a1a1a">
                                    <b>
                                        <br/>
                                    </b>
                                </font>
                                <span style="color: rgb(26, 26, 26);">
                                    <b>
                                        (B, seq_len, n_heads, head_dim/2)
                                    </b>
                                </span>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="180" y="538" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    x_rotated = x_complex * freqs_complex...
                </text>
            </switch>
        </g>
        <path d="M 180 669.75 L 180 693.38" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 180 698.63 L 176.5 691.63 L 180 693.38 L 183.5 691.63 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="0" y="599.75" width="360" height="70" fill="#ccffe6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 358px; height: 1px; padding-top: 635px; margin-left: 1px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    x_out = torch.view_as_real(x_rotated)
                                </font>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                                <b style="color: rgb(26, 26, 26);">
                                    (B, seq_len, n_heads, head_dim/2) -&gt;
                                    <br/>
                                </b>
                                <b style="color: rgb(26, 26, 26);">
                                    (B, seq_len, n_heads, head_dim/2, 2)
                                </b>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="180" y="638" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    x_out = torch.view_as_real(x_rotated)(B, seq_len, n_heads, h...
                </text>
            </switch>
        </g>
        <path d="M 360 769.75 L 467.57 509.39" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 469.57 504.53 L 470.14 512.34 L 467.57 509.39 L 463.67 509.67 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="0" y="699.75" width="360" height="70" fill="#ccffe6" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 358px; height: 1px; padding-top: 735px; margin-left: 1px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    x_out = x_out.reshape(*x.shape)
                                </font>
                                <b style="color: rgb(26, 26, 26);">
                                    <br/>
                                </b>
                                <b style="color: rgb(26, 26, 26);">
                                    (B, seq_len, n_heads, head_dim)
                                </b>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="180" y="738" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    x_out = x_out.reshape(*x.shape)(B, seq_len, n_heads, head_di...
                </text>
            </switch>
        </g>
        <path d="M 1010 -0.25 L 1150 -0.25 L 1170 49.75 L 1150 99.75 L 1010 99.75 L 990 49.75 Z" fill="#ffff66" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 50px; margin-left: 991px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font style="font-size: 18px;">
                                        SelfAttention
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="53" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    SelfAttention
                </text>
            </switch>
        </g>
        <path d="M 105 99.75 L 245 99.75 L 265 149.75 L 245 199.75 L 105 199.75 L 85 149.75 Z" fill="#ffff66" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 150px; margin-left: 86px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font style="font-size: 18px;">
                                        apply_RoPE
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="175" y="153" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    apply_RoPE
                </text>
            </switch>
        </g>
        <path d="M 1080 669.75 L 1080 710.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 716.13 L 1076.5 709.13 L 1080 710.88 L 1083.5 709.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="850" y="589.75" width="460" height="80" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 630px; margin-left: 851px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <i>
                                        Put in cache
                                    </i>
                                </b>
                                <br/>
                                cache_k[:B, start_pos:start_pos + seq_len] = xk
                                <br/>
                                cache_v[:B, start_pos:start_pos + seq_len] = xv
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="635" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    Put in cache...
                </text>
            </switch>
        </g>
        <path d="M 800 629.75 L 843.63 629.75" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 848.88 629.75 L 841.88 633.25 L 843.63 629.75 L 841.88 626.25 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="460" y="592.88" width="340" height="73.75" fill="#fad7ac" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 338px; height: 1px; padding-top: 630px; margin-left: 461px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <b>
                                        cache_k = torch.zeros(
                                        <br/>
                                        max_batch_size, max_seq_len, n_heads_kv, head_dim)
                                        <br/>
                                    </b>
                                    similarly
                                    <b>
                                        cache_v
                                    </b>
                                    <br/>
                                    <i>
                                        max_batch_size, max_seq_len ModelArgs for KV cache
                                    </i>
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="630" y="633" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    cache_k = torch.zeros(...
                </text>
            </switch>
        </g>
        <path d="M 1080 837.25 L 1080 870.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 876.13 L 1076.5 869.13 L 1080 870.88 L 1083.5 869.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="850" y="717.25" width="460" height="120" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 777px; margin-left: 851px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <i>
                                        Retreive from cache (everything upto this point)
                                    </i>
                                </b>
                                <br/>
                                keys = cache_k[:B, :start_pos + seq_len]
                                <br/>
                                values = cache_v[:B, :start_pos + seq_len]
                                <br/>
                                <br/>
                                <b>
                                    <i>
                                        (B, seq_len_kv, n_heads_kv, head_dim)
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="783" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    Retreive from cache (everything upto this point)...
                </text>
            </switch>
        </g>
        <path d="M 1363.75 582.25 L 1407.5 626 L 1363.75 669.75 L 1320 626 Z" fill="#cc0000" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 85px; height: 1px; padding-top: 626px; margin-left: 1321px;">
                        <div data-drawio-colors="color: #1A1A1A; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font color="#e6e6e6">
                                        seq_len = 1
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1364" y="630" fill="#1A1A1A" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    seq_len = 1
                </text>
            </switch>
        </g>
        <path d="M 850 877.25 L 336.23 985.93" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 331.09 987.02 L 337.22 982.15 L 336.23 985.93 L 338.67 988.99 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 1080 997.25 L 1080 1030.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 1036.13 L 1076.5 1029.13 L 1080 1030.88 L 1083.5 1029.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="850" y="877.25" width="460" height="120" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 937px; margin-left: 851px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <i>
                                        Repeat heads to match n_heads_q
                                        <br/>
                                    </i>
                                </b>
                                keys = repeat_kv(keys, n_rep)
                                <br/>
                                values = repeat_kv(values, n_rep)
                                <br/>
                                <br/>
                                <b>
                                    <i>
                                        (B, seq_len_kv, n_heads_q, head_dim)
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="943" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    Repeat heads to match n_heads_q...
                </text>
            </switch>
        </g>
        <path d="M 175 1077.25 L 175 1110.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 175 1116.13 L 171.5 1109.13 L 175 1110.88 L 178.5 1109.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="20" y="987.25" width="310" height="90" fill="#ccccff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 1032px; margin-left: 21px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    Add a dimension
                                    <br/>
                                    <b>
                                        x = x[:, :, :, None, :]
                                        <br/>
                                        <br/>
                                    </b>
                                </font>
                                <b style="color: rgb(0, 0, 0);">
                                    <i style="">
                                        <font style="font-size: 12px;">
                                            (B, seq_len, n_heads_kv, head_dim) -&gt;
                                            <br/>
                                        </font>
                                    </i>
                                </b>
                                <b style="color: rgb(0, 0, 0);">
                                    <i>
                                        (B,
                                    </i>
                                </b>
                                <b style="color: rgb(0, 0, 0);">
                                    <i>
                                        seq_len
                                    </i>
                                </b>
                                <b style="color: rgb(0, 0, 0);">
                                    <i>
                                        , n_heads_kv, 1, head_dim)
                                    </i>
                                </b>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="175" y="1036" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Add a dimension...
                </text>
            </switch>
        </g>
        <path d="M 110 877.25 L 250 877.25 L 270 927.25 L 250 977.25 L 110 977.25 L 90 927.25 Z" fill="#ffff66" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 927px; margin-left: 91px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font style="font-size: 18px;">
                                        repeat_kv
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="180" y="931" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    repeat_kv
                </text>
            </switch>
        </g>
        <path d="M 175 1187.25 L 175 1220.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 175 1226.13 L 171.5 1219.13 L 175 1220.88 L 178.5 1219.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="10" y="1117.25" width="330" height="70" fill="#ccccff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 328px; height: 1px; padding-top: 1152px; margin-left: 11px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    Expand
                                    <br/>
                                    <b>
                                        x.expand(B,
                                    </b>
                                </font>
                                <b style="color: rgb(0, 0, 0);">
                                    seq_len
                                </b>
                                <font color="#1a1a1a">
                                    <b>
                                        , n_heads_kv, n_rep, head_dim)
                                        <br/>
                                        <br/>
                                    </b>
                                </font>
                                <b style="color: rgb(0, 0, 0);">
                                    <i>
                                        (B,
                                    </i>
                                </b>
                                <b style="color: rgb(0, 0, 0);">
                                    <i>
                                        seq_len
                                    </i>
                                </b>
                                <b style="color: rgb(0, 0, 0);">
                                    <i>
                                        , n_heads_kv, n_rep, head_dim)
                                    </i>
                                </b>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="175" y="1156" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Expand...
                </text>
            </switch>
        </g>
        <path d="M 340 1297.25 L 844.51 1000.48" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 849.04 997.82 L 844.78 1004.38 L 844.51 1000.48 L 841.23 998.35 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1156px; margin-left: 575px;">
                        <div data-drawio-colors="color: #1A1A1A; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
                                <span style="background-color: rgb(255, 255, 255);">
                                    <font style="font-size: 18px;">
                                        seq_len = seq_len_kv
                                        <br/>
                                        (Notation)
                                        <br/>
                                    </font>
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="575" y="1160" fill="#1A1A1A" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    seq_len = seq_len_kv...
                </text>
            </switch>
        </g>
        <rect x="10" y="1227.25" width="330" height="70" fill="#ccccff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 328px; height: 1px; padding-top: 1262px; margin-left: 11px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    Flatten
                                    <br/>
                                    <b>
                                        x.reshape(B,
                                    </b>
                                </font>
                                <b style="color: rgb(0, 0, 0);">
                                    seq_len
                                </b>
                                <font color="#1a1a1a">
                                    <b>
                                        , n_heads_kv * n_rep, head_dim)
                                        <br/>
                                        <br/>
                                    </b>
                                </font>
                                <b style="color: rgb(0, 0, 0);">
                                    <i>
                                        (B, seq_len, n_heads_kv * n_rep, head_dim)
                                    </i>
                                </b>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="175" y="1266" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Flatten...
                </text>
            </switch>
        </g>
        <path d="M 1080 1212.25 L 1080 1260.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 1266.13 L 1076.5 1259.13 L 1080 1260.88 L 1083.5 1259.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="850" y="1037.25" width="460" height="175" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 1125px; margin-left: 851px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <i>
                                        Split embd over multiple heads
                                        <br/>
                                    </i>
                                </b>
                                xq,
                                <font color="#3333ff">
                                    keys, values
                                </font>
                                all .transpose(1,2)
                                <br/>
                                <br/>
                                <b>
                                    <i>
                                        (B, 1, n_heads_q, head_dim) -&gt;
                                        <br/>
                                    </i>
                                </b>
                                <i style="">
                                    <b>
                                        (B, n_heads_q, 1,  head_dim)
                                    </b>
                                    <br/>
                                    and
                                    <br/>
                                </i>
                                <b>
                                    <i>
                                        <font color="#3333ff">
                                            (B, n_heads_q, seq_len_kv,  head_dim)
                                        </font>
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        <br/>
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="1130" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    Split embd over multiple heads...
                </text>
            </switch>
        </g>
        <path d="M 1080 1412.25 L 1080 1460.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 1466.13 L 1076.5 1459.13 L 1080 1460.88 L 1083.5 1459.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="800" y="1267.25" width="560" height="145" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 558px; height: 1px; padding-top: 1340px; margin-left: 801px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <i>
                                        Attention
                                        <br/>
                                    </i>
                                </b>
                                scores = torch.matmul(xq, keys.transpose(2,3) / sqrt(head_dim)
                                <br/>
                                <br/>
                                <b>
                                    <i>
                                        (B, n_heads_q, 1, head_dim) @
                                        <br/>
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        (B, n_heads_q, head_dim, seq_len_kv) -&gt;
                                        <br/>
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        (B, n_heads_q, 1, seq_len_kv)
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        <br/>
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="1345" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    Attention...
                </text>
            </switch>
        </g>
        <path d="M 1378.75 717.25 L 1437.5 776 L 1378.75 834.75 L 1320 776 Z" fill="#cc0000" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 115px; height: 1px; padding-top: 776px; margin-left: 1321px;">
                        <div data-drawio-colors="color: #1A1A1A; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font color="#e6e6e6">
                                        seq_len_kv != 1 ?
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1379" y="780" fill="#1A1A1A" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    seq_len_kv != 1 ?
                </text>
            </switch>
        </g>
        <path d="M 1388.75 1023.5 L 1447.5 1082.25 L 1388.75 1141 L 1330 1082.25 Z" fill="#cc0000" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 115px; height: 1px; padding-top: 1082px; margin-left: 1331px;">
                        <div data-drawio-colors="color: #1A1A1A; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(26, 26, 26); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font color="#e6e6e6">
                                        seq_len_q = 1
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1389" y="1086" fill="#1A1A1A" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    seq_len_q = 1
                </text>
            </switch>
        </g>
        <path d="M 1080 1577.25 L 1080 1620.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 1626.13 L 1076.5 1619.13 L 1080 1620.88 L 1083.5 1619.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="800" y="1467.25" width="560" height="110" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 558px; height: 1px; padding-top: 1522px; margin-left: 801px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <i>
                                        Attention (cont)
                                        <br/>
                                    </i>
                                </b>
                                scores = F.softmax(scores, dim = 1).type_as(xq)
                                <br/>
                                <b>
                                    <i>
                                        <br/>
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        (B, n_heads_q, 1, seq_len_kv)
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        <br/>
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="1528" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    Attention (cont)...
                </text>
            </switch>
        </g>
        <path d="M 1080 1777.25 L 1080 1830.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 1836.13 L 1076.5 1829.13 L 1080 1830.88 L 1083.5 1829.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="800" y="1627.25" width="560" height="150" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 558px; height: 1px; padding-top: 1702px; margin-left: 801px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <i>
                                        Attention (cont)
                                        <br/>
                                    </i>
                                </b>
                                <i style="">
                                    output = torch.matmul(scores, values)
                                    <br/>
                                    <br/>
                                </i>
                                <b>
                                    <i>
                                        (B, n_heads_q, 1, seq_len_kv) @
                                        <br/>
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        (B, n_heads_q, seq_len_kv, head_dim) -&gt;
                                        <br/>
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        (B, n_heads_q, 1,  head_dim)
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        <br/>
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="1708" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    Attention (cont)...
                </text>
            </switch>
        </g>
        <path d="M 1080 1987.25 L 1080 2030.88" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1080 2036.13 L 1076.5 2029.13 L 1080 2030.88 L 1083.5 2029.13 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="800" y="1837.25" width="560" height="150" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 558px; height: 1px; padding-top: 1912px; margin-left: 801px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i style="">
                                    <b>
                                        Split across heads
                                        <br/>
                                    </b>
                                    output = output.transpose(1,2).contiguous().view(B, 1, -1)
                                    <br/>
                                    <br/>
                                </i>
                                <b>
                                    <i>
                                        (B,
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        n_heads_q, 1,
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        head_dim) -&gt;
                                        <br/>
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        (B, 1,
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        n_heads_q,
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        head_dim)
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        -&gt;
                                        <br/>
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        (B, 1, n_heads_q * head_dim)
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        <br/>
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="1918" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    Split across heads...
                </text>
            </switch>
        </g>
        <path d="M 1270 2147.25 L 1719 1988.13" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1723.95 1986.37 L 1718.52 1992.01 L 1719 1988.13 L 1716.18 1985.41 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="890" y="2037.25" width="380" height="110" fill="#ffcccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 378px; height: 1px; padding-top: 2092px; margin-left: 891px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <i style="">
                                    <b>
                                        Matrix Multiplication
                                        <br/>
                                    </b>
                                    self.wo(output)
                                    <br/>
                                    <br/>
                                </i>
                                <b>
                                    <i>
                                        (B
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        , 1,
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        dim) -&gt;
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        (B, 1,
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        dim)
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        <br/>
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1080" y="2098" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    Matrix Multiplication...
                </text>
            </switch>
        </g>
        <path d="M 1425 2403.5 L 1425 2453.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1425 2458.88 L 1421.5 2451.88 L 1425 2453.63 L 1428.5 2451.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="1195" y="2323.5" width="460" height="80" fill="#cccccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 2364px; margin-left: 1196px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                swish = F.silu(self.w1(x))
                                <br/>
                                <b>
                                    <i>
                                        (B, 1, dim) -&gt; (B, 1, hidden_dim)
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1425" y="2369" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    swish = F.silu(self.w1(x))...
                </text>
            </switch>
        </g>
        <path d="M 1365 2196 L 1505 2196 L 1525 2246 L 1505 2296 L 1365 2296 L 1345 2246 Z" fill="#ffff66" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 2246px; margin-left: 1346px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <b>
                                    <font style="font-size: 18px;">
                                        FeedForward
                                    </font>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1435" y="2250" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    FeedForward
                </text>
            </switch>
        </g>
        <path d="M 1145 2301 L 1190.15 2339.38" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1194.15 2342.78 L 1186.55 2340.91 L 1190.15 2339.38 L 1191.08 2335.58 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 955 2336 L 955 2358.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 955 2363.88 L 951.5 2356.88 L 955 2358.63 L 958.5 2356.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="765" y="2266" width="380" height="70" fill="#ccccff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 378px; height: 1px; padding-top: 2301px; margin-left: 766px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    w1: nn.Linear(dim, hidden_dim)
                                    <br/>
                                </font>
                                <span style="color: rgb(26, 26, 26);">
                                    w2: nn.Linear(hidden_dim, dim)
                                    <br/>
                                </span>
                                <span style="color: rgb(26, 26, 26);">
                                    w3: nn.Linear(dim, hidden_dim)
                                </span>
                                <font color="#1a1a1a">
                                    <br/>
                                </font>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="955" y="2305" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    w1: nn.Linear(dim, hidden_dim)...
                </text>
            </switch>
        </g>
        <path d="M 955 2445 L 955 2459.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 955 2464.88 L 951.5 2457.88 L 955 2459.63 L 958.5 2457.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <path d="M 1145 2405 L 1190.1 2367.57" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1194.14 2364.21 L 1190.99 2371.38 L 1190.1 2367.57 L 1186.52 2365.99 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="765" y="2365" width="380" height="80" fill="#ccccff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 378px; height: 1px; padding-top: 2405px; margin-left: 766px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <font color="#1a1a1a">
                                    <b>
                                        Convention
                                    </b>
                                    <br/>
                                    hidden_dim = 4* dim
                                    <br/>
                                </font>
                                <span style="color: rgb(26, 26, 26);">
                                    hidden_dim = int(2 * dim / 3)
                                    <br/>
                                </span>
                                <span style="color: rgb(26, 26, 26);">
                                    hidden_dim = int(ffn_dim_multiplier * hidden_dim)
                                    <br/>
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="955" y="2409" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Convention...
                </text>
            </switch>
        </g>
        <path d="M 1145 2506 L 1192.59 2389.4" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1194.58 2384.54 L 1195.17 2392.34 L 1192.59 2389.4 L 1188.69 2389.69 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="765" y="2466" width="380" height="80" fill="#ccccff" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 378px; height: 1px; padding-top: 2506px; margin-left: 766px;">
                        <div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                <span style="color: rgb(26, 26, 26);">
                                    <b>
                                        Round hidden_dim to nearest multiple of multiple_of parameter
                                        <br/>
                                    </b>
                                    hidden_dim = multiple_of * (
                                    <br/>
                                    (hidden_dim + multiple_of - 1) // multiple_of)
                                </span>
                                <span style="color: rgb(26, 26, 26);">
                                    <br/>
                                </span>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="955" y="2510" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
                    Round hidden_dim to nearest multiple of multiple_of parameter...
                </text>
            </switch>
        </g>
        <path d="M 1425 2540 L 1425 2589.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1425 2594.88 L 1421.5 2587.88 L 1425 2589.63 L 1428.5 2587.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="1195" y="2460" width="460" height="80" fill="#cccccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 2500px; margin-left: 1196px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                x_V = self.w3(x)
                                <br/>
                                <b>
                                    <i>
                                        (B, 1, dim) -&gt; (B, 1, hidden_dim)
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1425" y="2505" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    x_V = self.w3(x)...
                </text>
            </switch>
        </g>
        <path d="M 1425 2676 L 1425 2709.63" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1425 2714.88 L 1421.5 2707.88 L 1425 2709.63 L 1428.5 2707.88 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="1195" y="2596" width="460" height="80" fill="#cccccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 2636px; margin-left: 1196px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                x = swish * x_V
                                <br/>
                                <b>
                                    <i>
                                        (B, 1,
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        hidden_dim
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        )
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1425" y="2641" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    x = swish * x_V...
                </text>
            </switch>
        </g>
        <path d="M 1655 2796 L 1724.32 2147.33" fill="none" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="stroke"/>
        <path d="M 1724.88 2142.11 L 1727.62 2149.44 L 1724.32 2147.33 L 1720.66 2148.7 Z" fill="#f0f0f0" stroke="#f0f0f0" stroke-miterlimit="10" pointer-events="all"/>
        <rect x="1195" y="2716" width="460" height="80" fill="#cccccc" stroke="#f0f0f0" pointer-events="all"/>
        <g transform="translate(-0.5 -0.5)">
            <switch>
                <foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;">
                    <div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 458px; height: 1px; padding-top: 2756px; margin-left: 1196px;">
                        <div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;">
                            <div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
                                x = self.w2(x)
                                <br/>
                                <b>
                                    <i>
                                        (B, 1,
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        dim
                                    </i>
                                </b>
                                <b>
                                    <i>
                                        )
                                    </i>
                                </b>
                            </div>
                        </div>
                    </div>
                </foreignObject>
                <text x="1425" y="2761" fill="#000000" font-family="Helvetica" font-size="18px" text-anchor="middle">
                    x = self.w2(x)...
                </text>
            </switch>
        </g>
    </g>
    <switch>
        <g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/>
        <a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank">
            <text text-anchor="middle" font-size="10px" x="50%" y="100%">
                Text is not SVG - cannot display
            </text>
        </a>
    </switch>
</svg>